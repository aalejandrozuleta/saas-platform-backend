FROM node:24-alpine

RUN corepack enable && corepack prepare pnpm@latest --activate

WORKDIR /app

# Workspace metadata
COPY pnpm-workspace.yaml ./
COPY pnpm-lock.yaml ./

# Manifests mÃ­nimos
COPY services/api-gateway/package.json services/api-gateway/
COPY shared/package.json shared/

# Instalar deps + devDeps del micro
RUN pnpm install --filter api-gateway... --include=dev

# CÃ³digo fuente
COPY services/api-gateway services/api-gateway
COPY shared shared

# ðŸ”¥ CLAVE ABSOLUTA: aÃ±adir .bin del micro al PATH
ENV PATH="/app/services/api-gateway/node_modules/.bin:${PATH}"

WORKDIR /app/services/api-gateway

EXPOSE 3000
CMD ["pnpm", "dev"]


