FROM node:24-alpine

WORKDIR /app
RUN npm install -g pnpm

COPY ./package.json ./package.json
COPY ./pnpm-lock.yaml ./pnpm-lock.yaml
COPY ./pnpm-workspace.yaml ./pnpm-workspace.yaml
COPY ./tsconfig.base.json ./tsconfig.base.json

# SOLO package.json de los workspaces
COPY ./shared/package.json ./shared/package.json
COPY ./services/api-gateway/package.json ./services/api-gateway/package.json

RUN pnpm install

WORKDIR /app/services/api-gateway
EXPOSE 3000

CMD ["pnpm", "run", "dev"]
